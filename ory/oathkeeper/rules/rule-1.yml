- authenticators:
    - handler: noop
  authorizer:
    handler: allow
  id: noop-authenticator
  match:
    methods:
      - GET
      - POST
      - PATCH
      - PUT
      - DELETE
    url: http://ory.localhost/noop
  mutators:
    - handler: noop
  upstream:
    url: http://localhost:9300

- authenticators:
    - handler: unauthorized
  authorizer:
    handler: allow
  id: unauthorized-authenticator
  match:
    methods:
      - GET
      - POST
      - PATCH
      - PUT
      - DELETE
    url: http://ory.localhost/unauthorized
  mutators:
    - handler: noop
  upstream:
    url: http://localhost:9300

- authenticators:
    - handler: anonymous
      config:
        subject: anonymous
  authorizer:
    handler: allow
  id: anonymous-authenticator
  match:
    methods:
      - GET
      - POST
      - PATCH
      - PUT
      - DELETE
    url: http://ory.localhost/anonymous
  mutators:
    - handler: header
  upstream:
    url: http://localhost:9300

- authenticators:
    - config:
        subject: guest
      handler: anonymous
  authorizer:
    handler: allow
  id: allow-guest
  match:
    methods:
      - GET
      - POST
      - PATCH
      - PUT
      - DELETE
    url: http://127.0.0.1:<4457|8080>/<(login|recovery|verification|registration|favicon.ico)?>
  mutators:
    - handler: header
  upstream:
    url: http://127.0.0.1:4455

- authenticators:
    - config:
        preserve_path: true
        force_method: GET
      handler: cookie_session
  authorizer:
    handler: allow
  id: allow-cookie-session
  match:
    methods:
      - GET
      - POST
      - PATCH
      - PUT
      - DELETE
    url: http://127.0.0.1:<4457|8080>/<(?!login|recovery|verification|registration|favicon.ico).+>
  errors:
    - handler: redirect
      config:
        to: http://127.0.0.1:4457/login?return_to=/
  mutators:
    - handler: header
  upstream:
    url: http://127.0.0.1:4455

- authenticators:
    - handler: bearer_token
  authorizer:
    handler: allow
  id: allow-bearer-token
  match:
    methods:
      - GET
      - POST
      - PATCH
      - PUT
      - DELETE
    url: http://ory.localhost:8080/bearer_token
  mutators:
    - handler: header
  upstream:
    url: http://localhost:9300

- authenticators:
    - handler: oauth2_client_credentials
  authorizer:
    handler: allow
  id: allow-oauth2-client-credentials
  match:
    methods:
      - GET
      - POST
      - PATCH
      - PUT
      - DELETE
    url: http://ory.localhost:8080/oauth2
  mutators:
    - handler: header
  upstream:
    url: http://localhost:9300

- authenticators:
    - handler: jwt
  authorizer:
    handler: allow
  id: allow-jwt
  match:
    methods:
      - GET
      - POST
      - PATCH
      - PUT
      - DELETE
    url: http://ory.localhost:8080/jwt
  mutators:
    - handler: header
  upstream:
    url: http://localhost:9300

- authenticators:
    - handler: jwt
  authorizer:
    handler: remote
    config:
      remote: http://localhost:9400/authorize
      headers:
        X-Subject: "{{ print .Subject }}"
  id: authorize-requests
  match:
    methods:
      - GET
      - POST
      - PATCH
      - PUT
      - DELETE
    url: http://ory.localhost:8080/authorize
  mutators:
    - handler: header
  upstream:
    url: http://localhost:9300
